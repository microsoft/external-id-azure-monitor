{
    "$schema": "http://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "resourceGroupName": {
        "type": "string",
        "defaultValue": "[resourceGroup().name]",
        "metadata": {
          "description": "Name of the Resource Group"
        }
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "Location for resources"
        }
      },
      "workspaceName": {
        "type": "string",
        "metadata": {
          "description": "Name of the Log Analytics workspace"
        }
      },
      "workbookDisplayName": {
        "type": "string",
        "defaultValue": "User Behavior",
        "metadata": {
          "description": "Azure workbook for user behavior"
        }
      },
      "workbookType": {
        "type": "string",
        "defaultValue": "workbook",
        "metadata": {
          "description": "Gallery where the workbook will be shown"
        }
      },
      "workbookId": {
        "type": "string",
        "defaultValue": "[newGuid()]",
        "metadata": {
          "description": "Unique GUID for this workbook instance"
        }
      }
    },
    "variables": {
      "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
    },
    "resources": [
      {
        "type": "microsoft.insights/workbooks",
        "location": "[parameters('location')]",
        "apiVersion": "2022-04-01",
        "name": "[parameters('workbookId')]",
        "kind": "shared",
        "properties": {
          "displayName": "[parameters('workbookDisplayName')]",
          "sourceId": "[variables('workspaceResourceId')]",
          "category": "[parameters('workbookType')]",
          "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SigninLogs\\n| summarize SigninCount = count() by Location\\n| order by SigninCount desc\\n\\n\\n\\n\",\"size\":1,\"title\":\"User signins by location\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"map\",\"sortBy\":[],\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"Location\",\"sizeSettings\":\"SigninCount\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"Location\",\"legendMetric\":\"SigninCount\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"SigninCount\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"Users signins by location\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"[variables('workspaceResourceId')]\"]}"
        }
      }
    ],
    "outputs": {
      "workbookId": {
        "type": "string",
        "value": "[resourceId('microsoft.insights/workbooks', parameters('workbookId'))]"
      }
    }
  }
  